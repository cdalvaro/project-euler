name: Challenges

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

env:
  NSUnbufferedIO: YES

jobs:
  Challenges:
    runs-on: macOS-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Install xcbeautify
      run: brew install xcbeautify

    - name: Xcode unit test
      run: |
        set -o pipefail && \
        xcodebuild -project "Project Euler.xcodeproj" -scheme Challenges \
          -enableCodeCoverage YES build test 2>&1 \
        | xcbeautify && exit ${PIPESTATUS[0]}

    - name: Upload coverage to Codecov
      run: bash <(curl -s https://codecov.io/bash) -J 'Challenges'
